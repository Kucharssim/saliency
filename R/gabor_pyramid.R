gabor_pyramid <- function(gaussian_pyramid){
  out <- list()

  for(i in seq_along(gaussian_pyramid)){
    for(a in c("0", "45", "90", "135")){
      out[[as.character(i-1)]][[a]] <- OpenImageR::convolution(image = gaussian_pyramid[[i]], kernel = get_gabor_kernel(a))
    }
  }
  return(out)
}

get_gabor_kernel <- function(angle = c("0", "45", "90", "135")){
  angle <- match.arg(angle)

  out <- switch (as.character(angle),
    "0" = structure(c(-6.75783570154086e-17, -0.323737074762142, -0.53526142851899,
                    -0.41568663231873, 3.71392915500904e-17, 0.41568663231873, 0.53526142851899,
                    0.323737074762142, 2.25261190051362e-17, -8.41026241554719e-17,
                    -0.402897299170862, -0.666143610703488, -0.517330372450231, 4.6220595122275e-17,
                    0.517330372450231, 0.666143610703488, 0.402897299170862, 2.8034208051824e-17,
                    -9.83259292714232e-17, -0.471034664372528, -0.778800783071405,
                    -0.604820481195305, 5.40373503503839e-17, 0.604820481195306,
                    0.778800783071405, 0.471034664372528, 3.27753097571411e-17, -1.07989907025762e-16,
                    -0.517330372450232, -0.855345327307423, -0.664265347050633, 5.93484189114345e-17,
                    0.664265347050633, 0.855345327307423, 0.517330372450231, 3.59966356752541e-17,
                    -1.11417874650271e-16, -0.533752201274582, -0.882496902584595,
                    -0.685351392649594, 6.12323399573677e-17, 0.685351392649594,
                    0.882496902584595, 0.533752201274582, 3.71392915500904e-17, -1.07989907025762e-16,
                    -0.517330372450232, -0.855345327307423, -0.664265347050633, 5.93484189114345e-17,
                    0.664265347050633, 0.855345327307423, 0.517330372450231, 3.59966356752541e-17,
                    -9.83259292714232e-17, -0.471034664372528, -0.778800783071405,
                    -0.604820481195305, 5.40373503503839e-17, 0.604820481195306,
                    0.778800783071405, 0.471034664372528, 3.27753097571411e-17, -8.41026241554719e-17,
                    -0.402897299170862, -0.666143610703488, -0.517330372450231, 4.6220595122275e-17,
                    0.517330372450231, 0.666143610703488, 0.402897299170862, 2.8034208051824e-17,
                    -6.75783570154086e-17, -0.323737074762142, -0.53526142851899,
                    -0.41568663231873, 3.71392915500904e-17, 0.41568663231873, 0.53526142851899,
                    0.323737074762142, 2.25261190051362e-17), .Dim = c(9L, 9L), .Dimnames = list(
                      NULL, NULL)),
    "45" = structure(c(0.354599925128551, 0.310710940503485, 0.1013882375078,
                     -0.20972478922098, -0.482612322475582, -0.58520300189581, -0.479604375624248,
                     -0.241392430435649, 1.85897409355045e-16, 0.310710940503485,
                     0.107927217026502, -0.237649320475519, -0.58214158211336, -0.751415528356184,
                     -0.655541457356191, -0.351223913837691, 2.87923540046685e-16,
                     0.24139243043565, 0.101388237507801, -0.237649320475519, -0.619686488465347,
                     -0.851465343567202, -0.790733935612552, -0.450980432316141, 2.20616306500488e-16,
                     0.351223913837692, 0.479604375624248, -0.20972478922098, -0.58214158211336,
                     -0.851465343567202, -0.841731892937873, -0.511027779242444, 5.75224600225867e-17,
                     0.450980432316141, 0.655541457356191, 0.58520300189581, -0.482612322475582,
                     -0.751415528356184, -0.790733935612552, -0.511027779242444, 6.12323399573677e-17,
                     0.511027779242444, 0.790733935612552, 0.751415528356184, 0.482612322475582,
                     -0.58520300189581, -0.655541457356191, -0.450980432316141, 5.75224600225867e-17,
                     0.511027779242444, 0.841731892937873, 0.851465343567202, 0.58214158211336,
                     0.209724789220979, -0.479604375624248, -0.351223913837692, -1.25240717884303e-16,
                     0.450980432316141, 0.790733935612552, 0.851465343567202, 0.619686488465347,
                     0.237649320475519, -0.101388237507801, -0.24139243043565, -2.18145268795099e-16,
                     0.351223913837692, 0.655541457356191, 0.751415528356184, 0.58214158211336,
                     0.237649320475519, -0.107927217026502, -0.310710940503485, -1.40845171344772e-16,
                     0.241392430435649, 0.479604375624248, 0.58520300189581, 0.482612322475582,
                     0.20972478922098, -0.1013882375078, -0.310710940503485, -0.354599925128551
    ), .Dim = c(9L, 9L), .Dimnames = list(NULL, NULL)),
    "90" = structure(c(-6.75783570154086e-17, -8.41026241554719e-17, -9.83259292714232e-17,
                     -1.07989907025762e-16, -1.11417874650271e-16, -1.07989907025762e-16,
                     -9.83259292714232e-17, -8.41026241554719e-17, -6.75783570154086e-17,
                     -0.323737074762142, -0.402897299170862, -0.471034664372528, -0.517330372450232,
                     -0.533752201274582, -0.517330372450232, -0.471034664372528, -0.402897299170862,
                     -0.323737074762142, -0.53526142851899, -0.666143610703488, -0.778800783071405,
                     -0.855345327307423, -0.882496902584595, -0.855345327307423, -0.778800783071405,
                     -0.666143610703488, -0.53526142851899, -0.41568663231873, -0.517330372450231,
                     -0.604820481195305, -0.664265347050633, -0.685351392649594, -0.664265347050633,
                     -0.604820481195305, -0.517330372450231, -0.41568663231873, -9.75375691607198e-17,
                     -1.21387466083142e-16, 5.40373503503839e-17, 5.93484189114345e-17,
                     6.12323399573677e-17, 5.93484189114345e-17, 5.40373503503839e-17,
                     2.13828656327692e-16, 1.71816152260901e-16, 0.41568663231873,
                     0.517330372450231, 0.604820481195305, 0.664265347050633, 0.685351392649594,
                     0.664265347050633, 0.604820481195306, 0.517330372450232, 0.41568663231873,
                     0.53526142851899, 0.666143610703488, 0.778800783071405, 0.855345327307423,
                     0.882496902584595, 0.855345327307423, 0.778800783071405, 0.666143610703488,
                     0.53526142851899, 0.323737074762142, 0.402897299170862, 0.471034664372528,
                     0.517330372450231, 0.533752201274582, 0.517330372450231, 0.471034664372528,
                     0.402897299170862, 0.323737074762142, 1.85897409355045e-16, 2.8034208051824e-17,
                     3.27753097571411e-17, 3.59966356752541e-17, 3.71392915500904e-17,
                     3.59966356752541e-17, 3.27753097571411e-17, 2.8034208051824e-17,
                     2.25261190051362e-17), .Dim = c(9L, 9L), .Dimnames = list(NULL,
                                                                               NULL)),
    "135" = structure(c(-1.40845171344772e-16, -0.24139243043565, -0.479604375624248,
                      -0.58520300189581, -0.482612322475582, -0.20972478922098, 0.101388237507801,
                      0.310710940503485, 0.354599925128551, 0.241392430435649, -2.18145268795099e-16,
                      -0.351223913837692, -0.655541457356191, -0.751415528356184, -0.58214158211336,
                      -0.237649320475519, 0.107927217026502, 0.310710940503485, 0.479604375624248,
                      0.351223913837692, -1.25240717884303e-16, -0.450980432316141,
                      -0.790733935612552, -0.851465343567202, -0.619686488465347, -0.237649320475519,
                      0.1013882375078, 0.58520300189581, 0.655541457356191, 0.450980432316141,
                      5.75224600225867e-17, -0.511027779242444, -0.841731892937873,
                      -0.851465343567202, -0.58214158211336, -0.20972478922098, 0.482612322475582,
                      0.751415528356184, 0.790733935612552, 0.511027779242444, 6.12323399573677e-17,
                      -0.511027779242444, -0.790733935612552, -0.751415528356184, -0.482612322475582,
                      0.20972478922098, 0.58214158211336, 0.851465343567202, 0.841731892937873,
                      0.511027779242444, 5.75224600225867e-17, -0.450980432316141,
                      -0.655541457356191, -0.58520300189581, -0.1013882375078, 0.237649320475519,
                      0.619686488465347, 0.851465343567202, 0.790733935612552, 0.450980432316141,
                      2.20616306500488e-16, -0.351223913837691, -0.479604375624248,
                      -0.310710940503485, -0.107927217026502, 0.237649320475519, 0.58214158211336,
                      0.751415528356184, 0.655541457356191, 0.351223913837692, 2.87923540046685e-16,
                      -0.241392430435649, -0.354599925128551, -0.310710940503485, -0.101388237507801,
                      0.209724789220979, 0.482612322475582, 0.58520300189581, 0.479604375624248,
                      0.24139243043565, 1.85897409355045e-16), .Dim = c(9L, 9L), .Dimnames = list(
                        NULL, NULL))
  )

  return(out)
}
